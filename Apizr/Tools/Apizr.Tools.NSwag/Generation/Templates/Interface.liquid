using System.Threading.Tasks;
using System.Collections.Generic;
{% if HasSystemReferences -%}
using System;
{% endif -%}
{% if WithContext -%}
using Polly;
using Apizr.Policing;
{% endif -%}
{% if WithCancellationToken -%}
using System.Threading;
{% endif -%}
{% if WithPriority -%}
using Fusillade;
{% endif -%}
using Refit;
using Apizr;
{% if RegistrationType == 'None' -%}
{% if WithRetry -%}
{% if WithContext == false -%}
using Polly;
using Apizr.Policing;
{% endif -%}
using Polly.Extensions.Http;
using Polly.Registry;
{% endif -%}
{% if WithLogs -%}
using Apizr.Logging.Attributes;
{% endif -%}
{% if WithCacheProvider != 'None' -%}
using Apizr.Caching.Attributes;
{% endif -%}

{% if WithRetry -%}
[assembly:Policy("TransientHttpError")]
{% endif -%}
{% if WithLogs -%}
[assembly:Log]
{% endif -%}
{% if WithCacheProvider != 'None' -%}
[assembly:Cache]
{% endif -%}
{% endif -%}

namespace {{ NameSpace }}
{
    [WebApi]
    public interface I{{ Class }}Service
    {
{%     for operation in Operations -%}
{%         if operation.HasSummary -%}
        /// <summary>
        /// {{ operation.Summary | csharpdocs }}
        /// </summary>
{%         endif -%}
{%         for parameter in operation.NoHeaderParameters -%}
{%             if parameter.HasDescription -%}
        /// <param name="{{ parameter.VariableName }}">{{ parameter.Description | csharpdocs }}</param>
{%             endif -%}
{%         endfor -%}
{%         if operation.HasResultDescription -%}
        /// <returns>{{ operation.ResultDescription | csharpdocs }}</returns>
{%         endif -%}
{%         if operation.IsDeprecated -%}
        [Obsolete]
{%         endif -%}
{%  assign httpMethodLower = operation.HttpMethodLower -%}
{%  case httpMethodLower -%}
{%      when 'post' -%}
        [Post("{{ operation.Path }}")]
{%      when 'get' -%}
        [Get("{{ operation.Path }}")]
{%      when 'put' -%}
        [Put("{{ operation.Path }}")]
{%      when 'delete' -%}
        [Delete("{{ operation.Path }}")]
{%  endcase -%}  
{%      if operation.ApizrHeaderParameters.size > 0 -%}
        [Headers({% for headerParameter in operation.ApizrHeaderParameters -%}"{{ headerParameter.Name }}"{% if operation.ApizrHeaderParameters.size > 1 and headerParameter.IsLast == false  -%}, {% endif -%}{%  endfor -%})] 
{%      endif -%}
        {{ operation.PascalizeResultType }} {{ operation.ActualOperationName }}Async({% for parameter in operation.NoHeaderParameters -%}{% assign kindName = parameter.KindName -%}{% case kindName -%}{% when 'Query' -%}[Query] {% when 'Body' -%}[Body] {% endcase -%}{{ parameter.TypeInControllerInterface }} {{ parameter.VariableName }}{% if GenerateOptionalParameters and parameter.IsOptional and parameter.HasDefault == false -%}= null{% endif %}{% if parameter.IsSortLast == false or WithContext or WithCancellationToken or WithPriority and operation.HttpMethodLower == 'get' -%}, {% endif -%}{% endfor -%}{% if WithPriority and operation.HttpMethodLower == 'get'  -%}[Priority] int priority = (int)Priority.UserInitiated{% if WithContext or WithCancellationToken -%}, {% endif -%}{% endif -%}{% if WithContext -%}[Context] Context context = null{% if WithCancellationToken -%}, {% endif -%}{% endif -%}{% if WithCancellationToken -%}CancellationToken cancellationToken = default{% endif -%});

{%  endfor -%}
    }
}