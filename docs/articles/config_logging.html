<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title> | Apizr </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content=" | Apizr ">
      
      
      <link rel="icon" href="../resources/favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Respawnsive/Apizr/blob/dev/Apizr/Docs/Apizr.Docs/articles/config_logging.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../resources/logo.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">

<h2 id="watching">Watching</h2>
<p>Please find this dedicated tutorial video on YouTube about how to configure logging with Apizr:</p>
<div class="embeddedvideo"><iframe src="https://www.youtube-nocookie.com/embed/OSJcQEHyLhM" frameborder="0" allowfullscreen="true"></iframe></div>
<h2 id="configuring-logging">Configuring logging</h2>
<p>You can adjust logging configuration with:</p>
<ul>
<li><code>httpTracerMode</code> (default: <code>Everything</code>) Http traffic tracing mode:
<ul>
<li><code>ExceptionsOnly</code> logs only when an exception occurs</li>
<li><code>ErrorsAndExceptionsOnly</code> logs only when an exception or any error occurs</li>
<li><code>Everything</code> logs all, anytime</li>
</ul>
</li>
<li><code>trafficVerbosity</code> (default: <code>All</code>) Http traffic tracing verbosity (see HttpTracer), with:
<ul>
<li><code>None</code></li>
<li><code>RequestBody</code></li>
<li><code>RequestHeaders</code></li>
<li><code>RequestCookies</code></li>
<li><code>RequestAllButBody</code> = <code>RequestHeaders | RequestCookies</code>,</li>
<li><code>RequestAll</code> = <code>RequestBody | RequestHeaders | RequestCookies</code></li>
<li><code>ResponseBody</code></li>
<li><code>ResponseHeaders</code></li>
<li><code>ResponseAll</code> = <code>ResponseBody | ResponseHeaders</code></li>
<li><code>HeadersOnly</code> = <code>ResponseHeaders | RequestHeaders</code>,</li>
<li><code>AllButRequestBody</code> = <code>RequestAllButBody</code> | <code>ResponseAll</code>,</li>
<li><code>AllButResponseBody</code> = <code>RequestAll</code> | <code>ResponseHeaders</code>,</li>
<li><code>AllButBodies</code> = <code>ResponseAll | RequestAllButBody</code>,</li>
<li><code>All</code> = <code>ResponseAll | RequestAll</code></li>
</ul>
</li>
<li><code>logLevels</code> (default: [Low] <code>Trace</code>, [Medium] <code>Information</code> and [High] <code>Critical</code>) Log levels to apply while writing logs (see Microsoft.Enxtension.Logging), with:
<ul>
<li><code>Trace</code></li>
<li><code>Debug</code></li>
<li><code>Information</code></li>
<li><code>Warning</code></li>
<li><code>Error</code></li>
<li><code>Critical</code></li>
<li><code>None</code></li>
</ul>
</li>
</ul>
<p>Note that parameter logLevels is an array. It lets you provide from 0 to 3 different levels, as Apizr needs to get corresponding log level to each internal severity:</p>
<ul>
<li>Low: logs any internal and normal execution step</li>
<li>Medium: logs all missconfigured things, like asking for cache without providing any cache provider</li>
<li>High: logs errors and exceptions</li>
</ul>
<p>Obviously, providing more than 3 log levels would be pointless.</p>
<p>It means that:</p>
<ul>
<li>if you don't provide any log level at all, default levels will be applied ([Low] <code>Trace</code>, [Medium] <code>Information</code> and [High] <code>Critical</code>)</li>
<li>if you provide only 1 log level like <code>Information</code>, it will be applied to all log entries ([Low] <code>Information</code>, [Medium] <code>Information</code> and [High] <code>Information</code>). Up to you to catch exceptions and to log it at any level of your choice.</li>
<li>if you provide only 2 log levels like <code>Debug</code> and <code>Error</code>, the lowest will be applied to both Low and Medium ([Low] <code>Debug</code>, [Medium] <code>Debug</code> and [High] <code>Error</code>)</li>
<li>if you provide 3 log levels like <code>Debug</code>, <code>Warning</code> and <code>Critical</code>, it will be applied like you said ([Low] <code>Debug</code>, [Medium] <code>Warning</code> and [High] <code>Critical</code>)</li>
<li>if you provide more than 3 log levels, the lowest goes to Low, the highest to High and it will take the middle one for Medium</li>
<li>if you provide a <code>None</code> at some point, it will disable logging for corresponding severity</li>
</ul>
<p>You can configure logging at:</p>
<ul>
<li>Design time by attribute decoration</li>
<li>Register time by fluent configuration</li>
<li>Request time by fluent configuration.</li>
</ul>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_tabid-designing" role="tab" aria-controls="tabpanel_1_tabid-designing" data-tab="tabid-designing" tabindex="0" aria-selected="true">Designing</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_tabid-registering" role="tab" aria-controls="tabpanel_1_tabid-registering" data-tab="tabid-registering" tabindex="-1">Registering</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_tabid-requesting" role="tab" aria-controls="tabpanel_1_tabid-requesting" data-tab="tabid-requesting" tabindex="-1">Requesting</a>
</li>
</ul>
<section id="tabpanel_1_tabid-designing" role="tabpanel" data-tab="tabid-designing">

<p>You can set logging configuration at design time, decorating with the provided <code>Log</code> attribute.
Configuring logging with attribute allows you to use assembly scanning auto registration feature.</p>
<p>The <code>Log</code> attribute could decorate:</p>
<ul>
<li>Assembly: to set logging configuration to all assembly api interfaces/entities</li>
<li>Interface/Class: to set logging configuration to all request methods of the decorated api interface/entity</li>
<li>Method: to set logging configuration to a specific request method of an api interface or entity (with dedicated attribtes)</li>
</ul>
<p>You also can mix decoration levels to set a common logging configuration to all assembly api interfaces,
and/or a specific to all api interface methods,
and/or a specific to an api interface method.</p>
<pre><code class="lang-csharp">[assembly:Log]
namespace Apizr.Sample
{
    [BaseAddress(&quot;https://reqres.in/&quot;), Log(HttpMessageParts.RequestAll, 
        HttpTracerMode.ErrorsAndExceptionsOnly, 
        LogLevel.Information)]
    public interface IReqResService
    {
        [Get(&quot;/api/users&quot;), Log(HttpMessageParts.RequestBody, 
            HttpTracerMode.ExceptionsOnly, 
            LogLevel.Warning)]
        Task&lt;UserList&gt; GetUsersAsync();

        [Get(&quot;/api/users/{userId}&quot;)]
        Task&lt;UserDetails&gt; GetUserAsync([CacheKey] int userId);

        [Post(&quot;/api/users&quot;)]
        Task&lt;User&gt; CreateUser(User user);
    }
}
</code></pre>
<p>In this classic api example, we decided to apply the default logging configuration ([Low] <code>Trace</code>, [Medium] <code>Information</code> and [High] <code>Critical</code>) to all assembly api interfaces/entities.
Then some custom log settings about this specific api.</p>
<p>You’ll find some more log attributes but dedicated to CRUD apis (the ones ending with <code>Read</code>, <code>ReadAll</code>, <code>Create</code>, <code>Update</code> or <code>Delete</code> suffix), so you could define log settings at any level for CRUD apis too.</p>
<p>Here is CRUD api an example:</p>
<pre><code class="lang-csharp">[assembly:Log]
namespace Apizr.Sample.Models
{
    [BaseAddress(&quot;https://reqres.in/api/users&quot;)]
    [LogReadAll(HttpMessageParts.RequestAll, 
        HttpTracerMode.ErrorsAndExceptionsOnly, 
        LogLevel.Information)]
    [LogRead(HttpMessageParts.AllButBodies, 
        HttpTracerMode.ExceptionsOnly, 
        LogLevel.Debug)]
    public record User
    {
        [JsonPropertyName(&quot;id&quot;)]
        public int Id { get; init; }

        [JsonPropertyName(&quot;first_name&quot;)]
        public string FirstName { get; init; }

        [JsonPropertyName(&quot;last_name&quot;)]
        public string LastName { get; init; }

        [JsonPropertyName(&quot;avatar&quot;)]
        public string Avatar { get; init; }

        [JsonPropertyName(&quot;email&quot;)]
        public string Email { get; init; }
    }
}
</code></pre>
<p>Again, in this CRUD api example, we decided to apply the default logging configuration ([Low] <code>Trace</code>, [Medium] <code>Information</code> and [High] <code>Critical</code>) to all assembly api interfaces/entities.
Then some custom log settings about this specific api.</p>
</section>
<section id="tabpanel_1_tabid-registering" role="tabpanel" data-tab="tabid-registering" aria-hidden="true" hidden="hidden">
<h4 id="automatically">Automatically</h4>
<p>Logging parameters could be set automatically by providing an <code>IConfiguration</code> instance containing the logging settings:</p>
<pre><code class="lang-csharp">options =&gt; options.WithConfiguration(context.Configuration)
</code></pre>
<p>We can set it at common level (to all apis), specific level (dedicated to a named api) or even request level (dedicated to a named api's method).</p>
<p>Please heads to the <a href="config_settings.html">Settings</a>)  doc article to see how to configure logging automatically from loaded settings configuration.</p>
<h4 id="manually">Manually</h4>
<p>Configuring the logging fluently at register time allows you to set it dynamically.</p>
<p>You can set it thanks to this option:</p>
<pre><code class="lang-csharp">// direct configuration
options =&gt; options.WithLogging(HttpTracerMode.Everything, HttpMessageParts.All, LogLevel.Information)

// OR static individual factory configuration
options =&gt; options.WithLogging(() =&gt; Settings.HttpTracerMode, () =&gt; Settings.TrafficVerbosity, () =&gt; Settings.LogLevels)

// OR static single factory configuration
options =&gt; options.WithLogging(() =&gt; (Settings.HttpTracerMode, Settings.TrafficVerbosity, Settings.LogLevels))

// OR extended individual factory configuration
options =&gt; options.WithLogging(
    serviceProvider =&gt; serviceProvider.GetRequiredService&lt;IYourSettingsService&gt;().HttpTracerMode,
    serviceProvider =&gt; serviceProvider.GetRequiredService&lt;IYourSettingsService&gt;().TrafficVerbosity
    serviceProvider =&gt; serviceProvider.GetRequiredService&lt;IYourSettingsService&gt;().LogLevels)

// OR extended single factory configuration
options =&gt; options.WithLogging(servieProvider =&gt;
    {
        var settings = servieProvider.GetRequiredService&lt;IYourSettingsService&gt;();
        return (settings.HttpTracerMode, settings.TrafficVerbosity, settings.LogLevels);
    });
</code></pre>
<p>All logging fluent options are available with or without using registry.
It means that you can share logging configuration, setting it at registry level and/or set some specific one at api level.</p>
</section>
<section id="tabpanel_1_tabid-requesting" role="tabpanel" data-tab="tabid-requesting" aria-hidden="true" hidden="hidden">

<p>Configuring the logging fluently at request time allows you to set it at the very end, just before sending the request.</p>
<p>First, add the request options parameter <code>[RequestOptions] IApizrRequestOptions options</code> to your api methods to provide your logging configuration at request time.</p>
<p>Then, you can set it thanks to this option:</p>
<pre><code class="lang-csharp">// direct configuration
options =&gt; options.WithLogging(HttpTracerMode.Everything, HttpMessageParts.All, LogLevel.Information)
</code></pre>
</section>
</div>

<p>Note that you can mix design, register and request time logging configurations.
In case of mixed configurations, the internal duplicate strategy will be to take the closest one to the request.</p>
<p>Logging configuration duplicate strategy order:</p>
<ul>
<li>take fluent request configuration first if defined (request options)</li>
<li>otherwise the request attribute decoration one (method)</li>
<li>otherwise the fluent proper resgistration one (api proper options)</li>
<li>otherwise the api attribute decoration one (interface)</li>
<li>otherwise the fluent common resgistration one (registry common options)</li>
<li>otherwise the global attribute decoration one (assembly)</li>
</ul>
<h3 id="redacting">Redacting</h3>
<p>You may want to hide some header sensitive data from logs.</p>
<p>You can set which header values should be redacted before logging with this option:</p>
<pre><code class="lang-csharp">// direct configuration
options =&gt; options.WithLoggedHeadersRedactionNames(new[]{ &quot;MyHeaderKey&quot; })

// factory configuration
options =&gt; options.WithLoggedHeadersRedactionRule(header =&gt; header == &quot;MyHeaderKey&quot;)
</code></pre>
<p>From there, you should see your logs redacted like so:</p>
<pre><code class="lang-csharp"> ==================== HTTP REQUEST: [GET] ==================== 
GET https://reqres.in/api/users
Request Headers:
MyHeaderKey: *
</code></pre>
<p>Note that you can mix register and request time redaction configurations.
Also, the ApizrDuplicateStrategy optional parameter let you tell Apizr whether to override or not any parent redaction rules.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Respawnsive/Apizr/blob/dev/Apizr/Docs/Apizr.Docs/articles/config_logging.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Supported by Respawnsive
        </div>
      </div>
    </footer>
  </body>
</html>
